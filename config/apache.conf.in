# @BLURB@

NameVirtualHost *:80

<VirtualHost *:80>
DocumentRoot "@SF_PROJECTS_DIR@/@PROJECT_NAME@/web"
ServerName @SERVER_NAME@

AddType application/vnd.google-earth.kmz .kmz
AddType application/vnd.google-earth.kml+xml .kml
AddType application/gpx+xml .gpx
AddType application/json .json

ScriptAlias /cgi-bin/ @SF_PROJECTS_DIR@/@PROJECT_NAME@/web/static/cgi-bin/
<Directory "@SF_PROJECTS_DIR@/@PROJECT_NAME@/web/static/cgi-bin/">
  AllowOverride None
  Options ExecCGI -MultiViews +SymLinksIfOwnerMatch
  Order allow,deny
  Allow from all
</Directory>

#Alias /sf/ @SF_DATA_DIR@/web/sf/

<IfModule mod_deflate.c>
  <Directory @SF_PROJECTS_DIR@/@PROJECT_NAME@/web>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/x-javascript
  </Directory>
</IfModule>

<IfModule mod_rewrite.c>
  <Directory @SF_PROJECTS_DIR@/@PROJECT_NAME@/web>
    RewriteEngine On

    # Uncomment next line to neutralize site 
    #RewriteCond %{REMOTE_ADDR} !10\.27.*
    #RewriteRule ^(.*).(html|php)$ maintenance.html [L]

    # Combine and minify JavaScript and CSS
    RewriteCond %{QUERY_STRING} ^([0-9]+|debug)$
    RewriteRule ^(.*\.(js|css))$ /sfMyMinifyPlugin/sfMinifyPlugin.php?f=/$1&%{QUERY_STRING} [L,NC]

    # robots.txt
    RewriteCond %{HTTP_HOST} =@MOBILE_VERSION_HOST@
    RewriteRule ^robots.txt$ /mobile_robots.txt [L]

    # we skip all files with .something, except for .html, .rss, .gpx etc
    RewriteCond %{REQUEST_URI} \..+$
    RewriteCond %{REQUEST_URI} !\.html$
    RewriteCond %{REQUEST_URI} !(.*\.(rss|gpx|kml|json))$
    RewriteRule .* - [L]

    # RSS feed
    RewriteCond %{REQUEST_URI} \.rss$
    RewriteRule ^(.rss)$ index.php [QSA,L]

    # forums
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !^/forums/

    # if none of the above, we redirect to our front web controller
    RewriteRule ^(.*)$ index.php [QSA,L]

  </Directory>
</IfModule>

# remove etags to enable better client-side caching
<IfModule mod_headers.c>
    Header unset ETag
    FileETag None
</IfModule>

# makes images, css and js expire one week later in client cache
<IfModule mod_expires.c>
    <FilesMatch "\.(ico|jpg|jpeg|png|gif|svg|js|css)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 week"
    </FilesMatch>
</IfModule>

# big crash from our front web controller
ErrorDocument 500 "<h2>Application error</h2>Symfony application failed to start properly"

</VirtualHost>
