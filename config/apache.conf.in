# @BLURB@

NameVirtualHost *:80

<VirtualHost *:80>
DocumentRoot "@SF_PROJECTS_DIR@/@PROJECT_NAME@/web"
ServerName @SERVER_NAME@

ScriptAlias /cgi-bin/ @SF_PROJECTS_DIR@/@PROJECT_NAME@/web/static/cgi-bin/
<Directory "@SF_PROJECTS_DIR@/@PROJECT_NAME@/web/static/cgi-bin/">
  AllowOverride None
  Options ExecCGI -MultiViews +SymLinksIfOwnerMatch
  Order allow,deny
  Allow from all
</Directory>

#Alias /sf/ @SF_DATA_DIR@/web/sf/

<IfModule mod_deflate.c>
  <Directory @SF_PROJECTS_DIR@/@PROJECT_NAME@/web>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/x-javascript
    
    # It seems that Safari has some times troubles with compressed content
    BrowserMatch Safari no-gzip
  </Directory>
</IfModule>

<IfModule mod_rewrite.c>
  <Directory @SF_PROJECTS_DIR@/@PROJECT_NAME@/web>
    RewriteEngine On

    # Uncomment next line to neutralize site 
    #RewriteCond %{REMOTE_ADDR} !10\.27.*
    #RewriteRule ^(.*).(html|php)$ maintenance.html [L]

    # Combine and minify JavaScript and CSS
    @MINIFY_DEBUG@RewriteCond %{QUERY_STRING} ^([0-9]+|debug)$
    @MINIFY_DEBUG@RewriteRule ^(.*\.(js|css))$ /sfMyMinifyPlugin/sfMinifyPlugin.php?f=/$1&%{QUERY_STRING} [L,NC]

    # we skip all files with .something
    RewriteCond %{REQUEST_URI} \..+$
    RewriteCond %{REQUEST_URI} !\.html$
    RewriteCond %{REQUEST_URI} !(.*\.(rss|gpx|kml|json))$
    RewriteRule .* - [L]
  
    # RSS feed:
    RewriteCond %{REQUEST_URI} \.rss$
    RewriteRule ^(.rss)$ index.php [QSA,L]
  
    # we check if the .html version is here (caching)
    #RewriteRule ^$ index.html [QSA]
    #RewriteRule ^([^.]+)$ $1.html [QSA]
    
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !forums
    
    # no, so we redirect to our front web controller
    RewriteRule ^(.*)$ index.php [QSA,L]
  </Directory>
</IfModule>

# remove etags to enable better client-side caching
<IfModule mod_headers.c>
    Header unset ETag
    FileETag None
</IfModule>

# makes images, css and js expire one week later in client cache
<IfModule mod_expires.c>
    <FilesMatch "\.(ico|jpg|jpeg|png|gif|js|css)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 week"
    </FilesMatch>
</IfModule>

# big crash from our front web controller
ErrorDocument 500 "<h2>Application error</h2>Symfony application failed to start properly"

</VirtualHost>
